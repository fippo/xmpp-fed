<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd">
<?rfc compact="yes"?>
<?rfc strict="yes"?>
<?rfc symrefs="yes"?>
<?rfc toc="yes"?>
<?rfc tocdepth="4"?>
<rfc category="std" docName="draft-miller-xmpp-dns-prooftype-00" ipr="trust200902">
  <front>
    <title abbrev="XMPP SD">Using DNSSEC as a Prooftype for XMPP Delegation</title>
    <author initials="M." surname="Miller" fullname="Matthew Miller">
      <organization>Cisco Systems, Inc.</organization>
      <address>
        <postal>
          <street>1899 Wynkoop Street, Suite 600</street>
          <city>Denver</city>
          <region>CO</region>
          <code>80202</code>
          <country>USA</country>
        </postal>
        <email>mamille2@cisco.com</email>
      </address>
    </author>
    <author initials="P." surname="Saint-Andre" fullname="Peter Saint-Andre">
      <organization>Cisco Systems, Inc.</organization>
      <address>
        <postal>
          <street>1899 Wynkoop Street, Suite 600</street>
          <city>Denver</city>
          <region>CO</region>
          <code>80202</code>
          <country>USA</country>
        </postal>
        <email>psaintan@cisco.com</email>
      </address>
    </author>
    <date month="May" day="30" year="2012"/>
    <area>Applications</area>
    <keyword>Internet-Draft</keyword>
    <keyword>XMPP</keyword>
    <keyword>Extensible Messaging and Presence Protocol</keyword>
    <keyword>Jabber</keyword>
    <keyword>DNSSEC</keyword>
    <keyword>DANE</keyword>
    <abstract>
      <t>This document defines a model for securely delegating an XMPP service for a domain to a host associated with a different domain.</t>
    </abstract>
  </front>
  <middle>
    <section title="Introduction" anchor="intro">
      <t>In the core XMPP specification <xref target="RFC6120"/>, the domain to which an originating server wants to connect is asserted via the 'to' attribute of the &lt;stream:stream&gt; header, and the TLS certificate offered by the receiving server is required to match this source domain (e.g., "im.example.com").  However, this model can cause problems if the source domain is delegated (via DNS SRV records <xref target='RFC2782'/>) to a host associated with a different domain that is derived via SRV (e.g., "hosting.example.net"), since the derived domain might also be the delegate for a number of other source domains and, for operational and security reasons, a hosting server is rarely able to present a certificate that matches the source domain.</t>
      <t>Absent the use of DNS Security <xref target='RFC4033'/>, delegation via SRV does not provide a strong basis for checking the derived domain rather than the source domain.  This document describes how the use of DNSSEC with SRV results in more secure delegation, such that the originating XMPP server can legitimately check the derived domain rather than the source domain.</t>
    </section>
    <section title="Terminology" anchor="terms">
      <t>This document inherits terminology defined in <xref target="RFC4033"/>, <xref target="RFC6120"/>, and <xref target="RFC6125"/>.</t>
      <t>This document is applicable to connections made from an XMPP client to an XMPP server ("_xmpp-client._tcp") or between XMPP servers ("_xmpp-server._tcp"). To simplify discussion, this document uses "_xmpp-client._tcp" to refer to both cases, unless otherwise indicated.</t>
      <t>The capitalized key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <xref target="RFC2119"/>.</t>
    </section>
    <section title="Requirements" anchor="reqs">
      <t>The following conditions MUST be met:
        <list style="symbols">
          <t>The "SRV" records for the source domain MUST validate secure according to <xref target="RFC4033"/>.<vspace blankLines="1"/></t>
          <t>The address records ("A" or "AAAA") for the host MUST validate secure according to <xref target="RFC4033"/>.<vspace blankLines="1"/></t>
        </list>
      </t>
    </section>
    <section title="Protocol" anchor="protocol">
      <t>An initiating entity that wishes to use this prooftype performs the following:
        <list style="numbers">
          <t>Query for any "SRV" resource records for the source domain (e.g. "_xmpp-client._tcp.im.example.com").<vspace blankLines="1"/></t>
          <t>Validate the answer is provably secure; if the answer is not secure, is bogus, or is secure but negative (no records), the delegation is not secure.<vspace blankLines="1"/></t>
          <t>For each target host from the "SRV" answer (e.g. "hosting.example.net"), query for the "A" and/or "AAAA" resource records, as appropriate.<vspace blankLines="1"/></t>
          <t>Validate the answers are provably secure; if any answer is not secure, is bogus, or is secure but negative (no records), a connection to that target host SHOULD NOT be considered for secure delegation from the source domain.<vspace blankLines="1"/></t>
        </list>
      </t>
      <t>If the outcome is a provably secure delegation from the source domain to the target host, the initiating entity SHOULD consider the target name when verifying the TLS certificate via <xref target="RFC6125"/>.</t>
    </section>
    <section title="Use of DANE" anchor="dane">
      <t>The use of <xref target="DANE"/> for TLS certificate validation depends on if a source domain is securely delegated to a target host.</t>
      <section title="Secure Delegation" anchor="dane-secure">
        <t>If the delegation of a source domain to a target host is secure as above, then the following conditions apply:
          <list style="numbers">
            <t>SHOULD use the target host and port (e.g. "_5222._tcp.hosting.example.net").<vspace blankLines="1"/></t>
            <t>MAY use the target host without port (e.g. "hosting.example.net") if no "TLSA" resource records exist for the specific service<vspace blankLines="1"/></t>
            <t>MUST NOT use the source domain (e.g. "im.example.com" or "_5222._tcp.im.example.com")<vspace blankLines="1"/></t>
          </list>
        </t>
      </section>
      <section title="No Delegation" anchor="dane-none">
        <t>If there is no delegation (the source domain and the target host are identical, e.g. "im.example.com"), then the following conditions apply:
          <list style="numbers">
            <t>SHOULD use the source domain and standard port (e.g. "_5222._tcp.im.example.com").<vspace blankLines="1"/></t>
            <t>MAY use the source domain with port or protocol (e.g. "im.example.com") if no "TLSA" resource records exist for the specific service<vspace blankLines="1"/></t>
          </list>
        </t>
      </section>
      <section title="Insecure Delegation" anchor="dane-insecure">
        <t>If the delegation of a source domain to a target host is not proved secure, then <xref target="DANE"/> MUST NOT be used for TLS certificate validation.</t>
      </section>
    </section>
    <section title="Internationalization Considerations" anchor="i18n">
      <t>TBD</t>
    </section>
    <section title="IANA Considerations" anchor="iana">
      <t>TBD</t>
    </section>
    <section title="Security Considerations" anchor="security">
      <t>TBD</t>
    </section>
  </middle>
  <back>
    <references title="Normative References">
      <reference anchor="RFC2119">
        <front>
          <title abbrev="RFC Key Words">Key words for use in RFCs to Indicate Requirement Levels</title>
          <author initials="S." surname="Bradner" fullname="Scott Bradner">
            <organization>Harvard University</organization>
            <address>
              <postal>
                <street>1350 Mass.  Ave.</street>
                <street>Cambridge</street>
                <street>MA 02138</street>
              </postal>
              <phone>- +1 617 495 3864</phone>
              <email>-</email>
            </address>
          </author>
          <date month="March" year="1997"/>
          <area>General</area>
          <keyword>keyword</keyword>
          <abstract>
            <t>In many standards track documents several words are used to signify the requirements in the specification.  These words are often capitalized.  This document defines these words as they should be interpreted in IETF documents.  Authors who follow these guidelines should incorporate this phrase near the beginning of their document: 
              <list><t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this document are to be interpreted as described in RFC 2119.</t></list>
            </t>
            <t>Note that the force of these words is modified by the requirement level of the document in which they are used.</t>
          </abstract>
        </front>
        <seriesInfo name="BCP" value="14"/>
        <seriesInfo name="RFC" value="2119"/>
      </reference>
      <reference anchor='RFC2782'>
        <front>
          <title abbrev='DNS SRV RR'>A DNS RR for specifying the location of services (DNS SRV)</title>
          <author initials='A.' surname='Gulbrandsen' fullname='Arnt Gulbrandsen'>
            <organization>Troll Tech</organization>
            <address>
              <postal>
                <street>Waldemar Thranes gate 98B</street>
                <city>Oslo</city>
                <region />
                <code>N-0175</code>
                <country>NO</country>
              </postal>
              <phone>+47 22 806390</phone>
              <facsimile>+47 22 806380</facsimile>
              <email>arnt@troll.no</email>
            </address>
          </author>
          <author initials='P.' surname='Vixie' fullname='Paul Vixie'>
            <organization>Internet Software Consortium</organization>
            <address>
              <postal>
                <street>950 Charter Street</street>
                <city>Redwood City</city>
                <region>CA</region>
                <code>94063</code>
                <country>US</country>
              </postal>
              <phone>+1 650 779 7001</phone>
            </address>
          </author>
          <author initials='L.' surname='Esibov' fullname='Levon Esibov'>
            <organization>Microsoft Corporation</organization>
            <address>
              <postal>
                <street>One Microsoft Way</street>
                <city>Redmond</city>
                <region>WA</region>
                <code>98052</code>
                <country>US</country>
              </postal>
              <email>levone@microsoft.com</email>
            </address>
          </author>
          <date year='2000' month='February' />
          <abstract>
            <t>This document describes a DNS RR which specifies the location of the
             server(s) for a specific protocol and domain.</t>
          </abstract>
        </front>
        <seriesInfo name='RFC' value='2782' />
        <format type='TXT' octets='24013' target='http://www.rfc-editor.org/rfc/rfc2782.txt' />
      </reference>
      <reference anchor="RFC3447">
        <front>
          <title>Public-Key Cryptography Standards (PKCS) #1: RSA Cryptography Specifications Version 2.1</title>
          <author initials="J." surname="Jonsson" fullname="J. Jonsson">
            <organization/>
          </author>
          <author initials="B." surname="Kaliski" fullname="B. Kaliski">
            <organization/>
          </author>
          <date year="2003" month="February"/>
          <abstract>
            <t>This memo represents a republication of PKCS #1 v2.1 from RSA Laboratories' Public-Key Cryptography Standards (PKCS) series, and change control is retained within the PKCS process.  The body of this document is taken directly from the PKCS #1 v2.1 document, with certain corrections made during the publication process.  This memo provides information for the Internet community.</t>
          </abstract>
        </front>
        <seriesInfo name="RFC" value="3447"/>
        <format type="TXT" octets="143173" target="ftp://ftp.isi.edu/in-notes/rfc3447.txt"/>
      </reference>
      <reference anchor="RFC4033">
        <front>
          <title>DNS Security Introduction and Requirements</title>
          <author initials="R." surname="Arends" fullname="Roy Arends">
            <organization>Telematica Instituut</organization>
            <address>
              <email>roy.arends@telin.nl</email>
            </address>
          </author>
          <author initials="R." surname="Austein" fullname="Rob Austein">
            <organization>Internet Systems Consortium</organization>
            <address>
              <email>sra@isc.org</email>
            </address>
          </author>
          <author initials="M." surname="Larson" fullname="Matt Larson">
            <organization>VeriSign, Inc.</organization>
            <address>
              <email>mlarson@verisign.com</email>
            </address>
          </author>
          <author initials="D." surname="Massey" fullname="Dan Massey">
            <organization>Colorado State University</organization>
            <address>
              <email>massey@cs.colostate.edu</email>
            </address>
          </author>
          <author initials="S." surname="Rose" fullname="Scott Rose">
            <organization>National Institute for Standards and Technology</organization>
            <address>
              <email>scott.rose@nist.gov</email>
            </address>
          </author>
          <date month="May" year="2005"/>
        </front>
        <seriesInfo name="RFC" value="4033"/>
        <format type="TXT" target="http://tools.ietf.org/rfc/rfc4033.txt"/>
      </reference>
      <reference anchor="RFC4949">
        <front>
          <title>Internet Security Glossary, Version 2</title>
          <author initials="R." surname="Shirey" fullname="R. Shirey">
            <organization/>
          </author>
          <date year="2007" month="August"/>
          <abstract>
            <t>This Glossary provides definitions, abbreviations, and explanations of terminology for information system security.  The 334 pages of entries offer recommendations to improve the comprehensibility of written material that is generated in the Internet Standards Process (RFC 2026).  The recommendations follow the principles that such writing should (a) use the same term or definition whenever the same concept is mentioned; (b) use terms in their plainest, dictionary sense; (c) use terms that are already well-established in open publications; and (d) avoid terms that either favor a particular vendor or favor a particular technology or mechanism over other, competing techniques that already exist or could be developed.  This memo provides information for the Internet community.</t>
          </abstract>
        </front>
        <seriesInfo name="RFC" value="4949"/>
        <format type="TXT" octets="867626" target="ftp://ftp.isi.edu/in-notes/rfc4949.txt"/>
      </reference>
      <reference anchor="RFC5280">
        <front>
          <title>Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</title>
          <author initials="D." surname="Cooper" fullname="D. Cooper">
            <organization/>
          </author>
          <author initials="S." surname="Santesson" fullname="S. Santesson">
            <organization/>
          </author>
          <author initials="S." surname="Farrell" fullname="S. Farrell">
            <organization/>
          </author>
          <author initials="S." surname="Boeyen" fullname="S. Boeyen">
            <organization/>
          </author>
          <author initials="R." surname="Housley" fullname="R. Housley">
            <organization/>
          </author>
          <author initials="W." surname="Polk" fullname="W. Polk">
            <organization/>
          </author>
          <date year="2008" month="May"/>
          <abstract>
            <t>This memo profiles the X.509 v3 certificate and X.509 v2 certificate revocation list (CRL) for use in the Internet.  An overview of this approach and model is provided as an introduction.  The X.509 v3 certificate format is described in detail, with additional information regarding the format and semantics of Internet name forms.  Standard certificate extensions are described and two Internet-specific extensions are defined.  A set of required certificate extensions is specified.  The X.509 v2 CRL format is described in detail along with standard and Internet-specific extensions.  An algorithm for X.509 certification path validation is described.  An ASN.1 module and examples are provided in the appendices. [STANDARDS TRACK]</t>
          </abstract>
        </front>
        <seriesInfo name="RFC" value="5280"/>
        <format type="TXT" octets="352580" target="ftp://ftp.isi.edu/in-notes/rfc5280.txt"/>
      </reference>
      <reference anchor="RFC6120">
        <front>
          <title>Extensible Messaging and Presence Protocol (XMPP): Core</title>
          <author initials="P." surname="Saint-Andre" fullname="Peter Saint-Andre">
            <organization>Cisco</organization>
            <address>
              <email>psaintan@cisco.com</email>
            </address>
          </author>
          <date month="March" year="2011"/>
        </front>
        <seriesInfo name="RFC" value="6120"/>
        <format type="TXT"  target="http://tools.ietf.org/rfc/rfc6120.txt"/>
      </reference>
      <reference anchor="RFC6125">
        <front>
          <title>Representation and Verification of Domain-Based Application Service Identity within Internet Public Key Infrastructure Using X.509 (PKIX) Certificates in the Context of Transport Layer Security (TLS)</title>
          <author initials="P." surname="Saint-Andre" fullname="Peter Saint-Andre">
            <organization>Cisco</organization>
            <address>
              <email>psaintan@cisco.com</email>
            </address>
          </author>
          <author initials="J." surname="Hodges" fullname="Jeff Hodges">
            <organization>PayPal</organization>
            <address>
              <email>jeff.hodges@paypal.com</email>
            </address>
          </author>
          <date month="March" year="2011"/>
        </front>
        <seriesInfo name="RFC" value="6125"/>
        <format type="TXT" target="http://tools.ietf.org/rfc/rfc6125.txt"/>
      </reference>
    </references>
    <references title="Informative References">
      <reference anchor="DANE">
        <front>
          <title>The DNS-Based Authentication of Named Entities (DANE) Transport Layer Security (TLS) Protocol: TLSA</title>
          <author initials="P." surname="Hoffman" fullname="Paul Hoffman">
            <organization>VPN Consortium</organization>
            <address>
              <email>paul.hoffman@vpnc.org</email>
            </address>
          </author>
          <author initials="J." surname="Schlyter" fullname="Jakob Schlyter">
            <organization>Kirei AB</organization>
            <address>
              <email>jakob@kirei.se</email>
            </address>
          </author>
          <date month="May" year="2012"/>
        </front>
        <seriesInfo name="Internet-Draft" value="draft-ietf-dane-protocol-21"/>
        <format type="TXT" target="http://tools.ietf.org/html/draft-ietf-dane-protocol-21.txt"/>
      </reference>
    </references>
  </back>
</rfc>
